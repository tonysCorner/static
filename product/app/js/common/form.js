define(["common/toast","common/ajax","common/util","common/validator","common/dialog","common/urls"],function(e,t,n,r,i,s){function u(t,o){var u=!0;t.on("click",function(a){a.preventDefault();var f=o.val();if(!u)return;if(r.space(f))return e.toast({content:"手机号不能为空!"}),!1;if(!r.isMobilephone(f))return e.toast({content:"手机号格式错误,请输入11位手机号码"}),!1;u=!1,i.dialog({okCallback:function(r){$.ajax({url:s.r("captcha.html?phone="+f+"&picCaptcha="+r),type:"GET",dataType:"json",success:function(r){r.ret.code==0?(e.toast({content:"发送成功!"}),o.attr("readonly",!0),n.countDown(t,60,function(e,t){e.html(t+"s")},function(e){o.removeAttr("readonly"),u=!0,e.html("发送")})):(e.toast({content:r.ret.msg}),u=!0)},complete:function(){}})},cancelCallback:function(){u=!0}})})}var o={"上海":1,"北京":5,"广州":2,"杭州":3,"深圳":13,"武汉":33,"其他":-1},a=function(e){this.init(e)};return a.prototype.init=function(e){var t=this.createDom(e);this.initData(t),this.bindEvent(t,e)},a.prototype.createDom=function(e){var t=e.container,n=e.SYCFormHtml;return n=n.replace(/\{\{btnName\}\}/ig,e.btnName),t.html(n),{$insureCity:$("#insure-city"),$insureCityShow:$("#insure-city-show"),$insureCityId:$("#insure-city-id"),$expireDate:$("#expire-date-show"),$pro:$("#pro"),$proShow:$("#pro-show"),$carNumber:$("#car-number"),$phone:$("#phone"),$sendCode:$("#send-code"),$captcha:$("#captcha"),$agreement:$("#agreement"),$submit:$("#submit")}},a.prototype.initData=function(e){},a.prototype.bindEvent=function(i,a){i.$insureCity.on("change",function(e){e.preventDefault(),i.$insureCityShow.html($(this).val()),i.$insureCityId.val(o[$(this).val()]),console.log(i.$insureCityId.val())}),i.$pro.on("change",function(e){e.preventDefault(),i.$proShow.html($(this).val()),console.log($(this).val())}),u(i.$sendCode,i.$phone),$("input").on("input",function(e){e.preventDefault();var t={cid:i.$insureCityId.val(),expire:i.$expireDate.val(),carNumber:i.$carNumber.val(),phone:i.$phone.val(),captcha:i.$captcha.val()};n.inputNotNull(t)?i.$submit.hasClass("active")||i.$submit.addClass("active"):i.$submit.hasClass("active")&&i.$submit.removeClass("active")}),i.$submit.on("click",function(o){o.preventDefault();var u={insure_city:i.$insureCityId.val(),expire_date:i.$expireDate.html(),car_number:i.$proShow.html()+n.trim(i.$carNumber.val().toUpperCase(),"g"),phone:i.$phone.val(),captcha:i.$captcha.val(),reg_source:a.sourceType};if(r.space(u.insure_city))return e.toast({content:"请选择投保城市"}),!1;if(!r.isCarNumber(u.car_number))return e.toast({content:"车牌号码格式不正确"}),!1;if(i.$expireDate.html().trim()=="请选择")return e.toast({content:"请选择保险到期月"}),!1;if(!r.isMobilephone(u.phone))return e.toast({content:"手机号格式错误,请输入11位手机号码"}),!1;if(!r.isCaptcha(u.captcha))return e.toast({content:"请输入正确的验证码"}),!1;if(!i.$agreement.is(":checked"))return e.toast({content:"请勾选四叶草用户协议"}),!1;_hmt.push(["_trackEvent","channel-"+a.templateId,"click","submitBtn",1]),t.SYCAjax({type:"POST",url:s.r("customerLogin.html"),data:u,success:function(t){document.body.scrollTop=0,t.code==0?a.sucCallback():t.code==1006||t.code==1007?a.errCallback():e.toast({content:t.msg})}})})},{sycForm:a}});